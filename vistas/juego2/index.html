<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Juego 2 ‚Äî Selecci√≥n de Nivel</title>
    <link rel="stylesheet" href="../../css/global.css">
    <link rel="stylesheet" href="../../css/layout.css">
    <link rel="stylesheet" href="../../css/ui.css">
    <link rel="stylesheet" href="../../css/vistas/index.css">
    <link rel="stylesheet" href="../../css/indexJuegos.css">
</head>

<body class="body">
    <!-- App Bar -->
    <header class="app-bar">
        <button class="app-bar-back" onclick="location.href='../../index.html'" aria-label="Volver">
            ‚Üê
        </button>
        <span class="app-bar-title">Eco de Sonidos</span>
    </header>
    <main class="level-select-container">
        <div>
            <h2 class="game-description">Refuerza tu conciencia fonol√≥gica, discriminaci√≥n de fonemas y memoria auditiva</h2>
        </div>
        <div class="progress-general">
            <span>Progreso general</span>
            <span class="progress-general-value">| <span id="progress-general-num">0%</span></span>
            <div class="progress-container-m">
                <div class="progress-fill" id="progress-general-bar" style="width: 95%"></div>
            </div>
        </div>
        <section class="levels-list">
            <!-- Niveles se renderizan por JS -->
        </section>
    </main>
  
    <script type="module">
        import { hasCompletedLevel } from '../../js/util.js';
        // Configuraci√≥n de niveles
        const levels = [
            {
                key: 'nivel-facil',
                title: 'NIVEL 1',
                desc: 'Un eco en el ambiente',
                icon: 'üåÑ'
            },
            {
                key: 'nivel-intermedio',
                title: 'NIVEL 2',
                desc: 'Escuchaste eso?',
                icon: 'üåÑ'
            },
            {
                key: 'nivel-dificil',
                title: 'NIVEL 3',
                desc: 'Atento al intruso',
                icon: 'üîç'
            }
        ];
        const levelOrder = levels.map(l => l.key);
        console.log(levelOrder);
        const gameId = 'juego2';
        (async () => {
            let unlockedLevels = 1;
            let completedCount = 0;
            const completedLevels = {};
            for (let i = 0; i < levelOrder.length; i++) {
                const key = levelOrder[i];
                const completed = hasCompletedLevel(gameId, key);
                completedLevels[key] = completed;
                if (completed) {
                    completedCount++;
                    unlockedLevels = i + 2;
                }
            }

            let pendienteHtml = '<span class="circle-check" aria-label="Pendiente"></span>';
            let completedHtml = '<span class="circle-check completed" aria-label="Completado"></span>';
            // Renderizar niveles
            const list = document.querySelector('.levels-list');
            list.innerHTML = '';
            levels.forEach((lvl, idx) => {
                let isLocked = idx >= unlockedLevels;
                let isCompleted = completedLevels[lvl.key];
                let isCurrent = !isLocked && !isCompleted;
                let action = '';
                if (isLocked) {
                    action = `<button class='btn btn-locked' disabled><span style='font-size:1.1rem;'>üîí</span> Desbloquea</button>`;
                } else {
                    action = `<button class="circle-play" aria-label="Jugar nivel">
  <svg viewBox="0 0 24 24" aria-hidden="true">
    <path d="M8 6v12l10-6z" />
  </svg>
</button>
        `;
                }
                list.innerHTML += `
                <div class='level-card${isLocked ? ' locked' : ''}${isCompleted ? ' completed' : ''}'>
                    <div class='level-icon'>${isCompleted ? completedHtml : pendienteHtml}</div>
                    <div class='level-info'>
                        <div class='level-title'>${lvl.title}</div>
                        <div class='level-desc'>${lvl.desc}</div>
                    </div>
                    <div class='level-action'>${action}</div>
                </div>`;


            });
            // Progreso general
            const totalProgress = Math.round((completedCount / levels.length) * 100);
            document.getElementById('progress-general-num').textContent = totalProgress + '%';
            document.getElementById('progress-general-bar').style.width = totalProgress + '%';
            // Acciones de los botones
            document.querySelectorAll('.level-card:not(.locked) .circle-play').forEach((btn, idx) => {
                btn.addEventListener('click', () => {
                    const pageMap = {
                        0: 'juego2nivel1.html',
                        1: 'juego2nivel2.html',
                        2: 'juego2nivel3.html'
                    };
                    const page = pageMap[idx] || 'juego2nivel1.html';
                    location.href = `${page}?level=${encodeURIComponent(levels[idx].key)}`;
                });
            });
        })();
    </script>
</body>

</html>