<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Insignias obtenidas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../../css/layout.css">
    <link rel="stylesheet" href="../css/ui.css">
    <link rel="stylesheet" href="../css/vistas/juego1nivel1.css">
    <style>
        .insignia-card.mini.entra-cofre {
            animation: subirBajarCofre 1.7s cubic-bezier(.68, -0.55, .27, 1.55) forwards;
        }

        @keyframes subirBajarCofre {
            0% {
                opacity: 1;
                transform: scale(0.45) translateY(0) translateX(var(--card-x-inicial, 0));
            }

            40% {
                opacity: 1;
                transform: scale(0.45) translateY(-800px) translateX(var(--card-x-inicial, 0));
            }

            70% {
                opacity: 1;
                transform: scale(0.45) translateY(-400px) translateX(calc(var(--card-x-inicial, 0) * 0.5));
            }

            85% {
                opacity: 1;
                transform: scale(0.45) translateY(-320px) translateX(0px);
            }

            100% {
                opacity: 0;
                transform: scale(0.45) translateY(-320px) translateX(0px);
            }
        }

        .insignia-card.mini {
            position: static;
            left: unset;
            transform: scale(0.45);
            opacity: 1;
            min-width: 90px;
            max-width: 120px;
            min-height: 90px;
            max-height: 140px;
            padding: 0.5rem 0.5rem 0.3rem 0.5rem;
            margin-bottom: 0;
            margin-top: 0;
            margin-left: 0;
            margin-right: 0;
            box-shadow: 0 2px 12px #0002;
            transition: all 0.7s cubic-bezier(.68, -0.55, .27, 1.55);
            display: block !important;
        }

        .insignia-card.mini .insignia-title {
            font-size: 0.85rem;
        }

        .insignia-card.mini .insignia-desc {
            font-size: 0.75rem;
        }

        .insignias-fila {
            width: 100vw;
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            gap: 1.2rem;
            justify-content: center;
            align-items: flex-start;
            margin-top: -20px;
            margin-bottom: 10px;
            min-height: 120px;
            pointer-events: none;
        }

        body {
            background: #f7f7fa;
            min-height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .cofre-container {
            position: relative;
            width: 220px;
            height: 220px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 80px;
            margin-bottom: 40px;
        }

        .cofre {
            width: 100%;
            height: 100%;
            background: url('../assets/animaciones/cofre_cerrado.json') no-repeat center/contain;
            animation: shakeCofre 1.2s infinite ease-in-out;
            cursor: pointer;
        }

        @keyframes shakeCofre {
            0% {
                transform: translateY(0) rotate(-2deg);
            }

            50% {
                transform: translateY(-10px) rotate(2deg);
            }

            100% {
                transform: translateY(0) rotate(-2deg);
            }
        }

        .insignia-card {
            position: absolute;
            left: 50%;
            transform: translate(-50%, 120px) scale(0.7);
            opacity: 0;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 4px 32px #0002;
            padding: 1.5rem 2rem 1.2rem 2rem;
            min-width: 260px;
            text-align: center;
            z-index: 10;
            transition: all 0.7s cubic-bezier(.68, -0.55, .27, 1.55);
        }

        .insignia-card.visible {
            opacity: 1;
            transform: translate(-50%, -180px) scale(1);
        }

        .insignia-img {
            width: 72px;
            height: 72px;
            margin-bottom: 1rem;
        }

        .insignia-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .insignia-desc {
            font-size: 1rem;
            color: #444;
            margin-bottom: 1.2rem;
        }

        .btn-recoger {
            background: #ffd700;
            color: #222;
            border: none;
            border-radius: 1.2rem;
            padding: 0.7rem 2.2rem;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 8px #0001;
            transition: background 0.2s;
        }

        .btn-recoger:hover {
            background: #ffe066;
        }

        .badges-screen {
            background:
                radial-gradient(circle at center,
                    rgba(255, 215, 130, 0.55) 0%,
                    rgba(255, 215, 130, 0.28) 28%,
                    rgba(242, 230, 210, 0.9) 55%,
                    var(--bg-main) 100%);

        }


        .badges-screen::before {
            content: "";
            position: fixed;
            inset: 0;
            background:
                radial-gradient(circle at center,
                    rgba(255, 255, 255, 0.12),
                    transparent 60%);
            pointer-events: none;
        }
    </style>
</head>

<body class="badges-screen">
    <div id="pixel-container">
        <div id="pixel-animation"></div>
        <div id="pixel-dialog">
            <p id="pixel-text"></p>
        </div>
    </div>
    <div class="cofre-container">
        <div class="cofre" id="cofre"></div>
        <div class="insignia-card" id="insignia-card" style="display:none;"></div>
    </div>
    <div class="insignias-fila" id="insignias-fila"></div>

    <div class="actions" id="insignias-actions"
        style="display:none; margin-top:2.5rem; justify-content:center; gap:1rem;">
        <button id="btn-repeat" class="btn btn-primary">Repetir nivel</button>
        <button id="btn-next" class="btn btn-success">Siguiente nivel</button>
        <button id="btn-menu" class="btn btn-secondary">Volver al menú</button>
    </div>
    
    <script src="../../js/lottie.min.js"></script>
    <script type="module" src="../js/insignias.js"></script>
    <script src="../js/cofre_animacion.js"></script>
    <script>
        // Configuración dinámica de botones usando los parámetros de la URL
        document.addEventListener('DOMContentLoaded', function () {
            const params = new URLSearchParams(window.location.search);
            const game = params.get('game');
            let level = params.get('level');
            // Mapear niveles a nombre y número
            const levelNames = ['nivel-facil', 'nivel-intermedio', 'nivel-dificil'];
            let nivelNum = 1;
            if (level) {
                if (level === 'nivel-facil') nivelNum = 1;
                else if (level === 'nivel-intermedio') nivelNum = 2;
                else if (level === 'nivel-dificil') nivelNum = 3;
                else {
                    const match = level.match(/(\d+)/);
                    if (match) nivelNum = parseInt(match[1], 10);
                }
            }
            if (game) {
                // Repetir nivel
                document.getElementById('btn-repeat').onclick = function () {
                    window.location.href = `../vistas/${game}/${game}nivel${nivelNum}.html?game=${game}&level=${level || ''}`;
                };
                // Siguiente nivel
                document.getElementById('btn-next').onclick = function () {
                    let nextLevelName = levelNames[nivelNum] || '';
                    window.location.href = `../vistas/${game}/${game}nivel${nivelNum + 1}.html?game=${game}&level=${nextLevelName}`;
                };
                // Volver al menú
                document.getElementById('btn-menu').onclick = function () {
                    window.location.href = `../vistas/${game}/index.html`;
                };
            }
        });
    </script>
</body>

</html>