<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Juego 1 — Selección de Nivel</title>
    <link rel="stylesheet" href="../../css/global.css">
    <link rel="stylesheet" href="../../css/layout.css">
    <link rel="stylesheet" href="../../css/ui.css">
    <link rel="stylesheet" href="../../css/vistas/index.css">
</head>
<body class="body--juegos">
    <main class="contenedor-juego-descripcion">
        <button class="btn btn-ghost" onclick="location.href='../../index.php'">← Volver</button>
        <h1>Juego 1 — Aventura entre Palabras</h1>
        <p>En este juego completarás fragmentos de texto arrastrando la palabra correcta al espacio en blanco. Mejora la discriminación visual y comprensión lectora.</p>

        <section class="niveles">
            <h3>Elegir nivel</h3>
            <div class="lista-niveles">
                                <button class="btn btn-primary level-btn" data-level="nivel-facil">Fácil</button>
                                <button class="btn btn-primary level-btn" data-level="nivel-intermedio">Intermedio</button>
                                <button class="btn btn-primary level-btn" data-level="nivel-dificil">Difícil</button>
            </div>
        </section>
        <style>
            .level-locked { background:#2b2b2b !important; color:#fff !important; opacity:0.9; cursor:not-allowed; }
            .level-locked small { display:block; font-size:0.8rem; opacity:0.85 }
        </style>
        <script type="module">
            import { hasCompletedLevel } from '../../js/util.js';

            const buttons = document.querySelectorAll('.level-btn');
            const levelOrder = ['nivel-facil','nivel-intermedio','nivel-dificil'];
            const gameId = 'juego1';

            buttons.forEach(btn => {
                const lvl = btn.dataset.level;
                btn.addEventListener('click', () => {
                    if (btn.disabled) return;
                    // map level -> page
                    const pageMap = {
                        'nivel-facil': 'juego1nivel1.html',
                        'nivel-intermedio': 'juego1nivel2.html',
                        'nivel-dificil': 'juego1nivel3.html'
                    };
                    const page = pageMap[lvl] || 'juego1nivel1.html';
                    location.href = `${page}?level=${encodeURIComponent(lvl)}`;
                });
            });

            (async ()=>{
                for (let i=0;i<levelOrder.length;i++){
                    const lvl = levelOrder[i];
                    const btn = Array.from(buttons).find(b=>b.dataset.level===lvl);
                    if (!btn) continue;
                    if (i===0) { btn.disabled = false; continue; }
                    const prev = levelOrder[i-1];
                    try {
                        const unlocked = hasCompletedLevel(gameId, prev);
                        if (!unlocked) {
                            btn.disabled = true;
                            btn.classList.add('level-locked');
                            btn.title = 'Nivel bloqueado. Completa el nivel anterior.';
                        }
                    } catch(e) { /* ignore */ }
                }
            })();
        </script>
    </main>
</body>
</html>
